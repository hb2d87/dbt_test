metrics:
 - name: active_users
   description: "Count of distinct active users - supports daily, weekly, monthly, and quarterly analysis"
   type: simple
   label: "Active Users"
   type_params:
     measure: unique_customers
   
   dimensions:
     - customer_state
     - customer_city
     - activity_date
   
   meta:
     responsible: "Product Analytics Team"
     accountable: "VP of Product"
     consulted: ["Marketing Team", "Customer Success Team"]
     informed: ["Executive Team", "Regional Managers", "Customer Support"]
     
     business_purpose: "Track user engagement across all time periods for Brazilian e-commerce platform"
     business_impact: "High - Core KPI for user engagement and product performance"
     kpi_type: "North Star Metric"
     
     supported_grains: ["day", "week", "month", "quarter"]
     
     frequency: "Daily monitoring, weekly reporting"
     sla_refresh: "Daily by 9 AM BRT"
     data_freshness: "T+1 day"
     
     calculation_logic: "Unique customers who placed at least one order in time period"
     exclusions: "Cancelled orders before payment are excluded"
     inclusions: "All order statuses except cancelled"
     
     target_ranges:
       daily_healthy: "10,000-50,000 users"
       monthly_growth: "15-25% YoY"
       geographic_coverage: "All 26 Brazilian states + Federal District"
     
     validation_rules:
       - "Must be >= 0"
       - "Cannot exceed total registered users"
       - "Should show expected weekly/seasonal patterns"
     
     data_quality_owner: "Data Engineering Team"
     market: "Brazilian E-commerce"
     currency: "BRL (Brazilian Real)"
     timezone: "America/Sao_Paulo"
     
    #  query_examples:
    #    daily_by_state: |
    #      SELECT customer_state, activity_date, active_users
    #      FROM {{ metrics.calculate(metric('active_users'), 
    #                              grain='day',
    #                              dimensions=['customer_state', 'activity_date']) }}
    #      WHERE activity_date >= CURRENT_DATE - 30
       
    #    weekly_national: |
    #      SELECT activity_date as week_start, SUM(active_users) as national_weekly_users
    #      FROM {{ metrics.calculate(metric('active_users'),
    #                              grain='week',
    #                              dimensions=['activity_date']) }}
    #      WHERE activity_date >= CURRENT_DATE - INTERVAL '12 weeks'
    #      GROUP BY activity_date
       
    #    monthly_by_city: |
    #      SELECT customer_city, activity_date as month_start, active_users
    #      FROM {{ metrics.calculate(metric('active_users'),
    #                              grain='month',
    #                              dimensions=['customer_city', 'activity_date']) }}
    #      WHERE activity_date >= CURRENT_DATE - INTERVAL '12 months'