version: 2

models:
  - name: stg_orders
    description: "Staging table for orders with comprehensive order details, customer info, and payment totals"
    columns:
      - name: order_id
        description: "Primary key - unique identifier for each order"
        tests:
          - unique
          - not_null
      - name: customer_id
        description: "Foreign key to customers"
        tests:
          - not_null
      - name: customer_unique_id
        description: "Unique customer identifier across all orders"
      - name: order_status
        description: "Raw order status from source system"
        tests:
          - not_null
      - name: order_status_grouped
        description: "Standardized order status (completed, cancelled, processing, etc.)"
        tests:
          - accepted_values:
              values: ['completed', 'in_transit', 'cancelled', 'processing', 'created', 'other']
      - name: order_purchase_timestamp
        description: "Timestamp when the order was placed"
        tests:
          - not_null
      - name: order_approved_at
        description: "Timestamp when the order was approved"
      - name: order_delivered_carrier_date
        description: "Timestamp when order was delivered to carrier"
      - name: order_delivered_customer_date
        description: "Timestamp when order was delivered to customer"
      - name: order_estimated_delivery_date
        description: "Estimated delivery date communicated to customer"
      - name: delivered_on_time
        description: "Boolean indicating if order was delivered on or before estimated date"
      - name: days_to_delivery
        description: "Number of days from order to delivery"
      - name: customer_city
        description: "Customer's city"
      - name: customer_state
        description: "Customer's state"
      - name: total_payment_value
        description: "Total amount paid for the order"
        tests:
          - not_null
      - name: voucher_value
        description: "Total value of vouchers used for the order (0 if no vouchers)"
        tests:
          - not_null
      - name: payment_methods_count
        description: "Number of different payment methods used for this order"

  - name: stg_order_payments
    description: "Staging table for order payments with payment type categorization"
    columns:
      - name: order_id
        description: "Foreign key to orders"
        tests:
          - not_null
      - name: payment_sequential
        description: "Sequential number for payments within an order"
      - name: payment_type
        description: "Raw payment method type"
      - name: payment_type_display
        description: "Human-readable payment method"
      - name: payment_category
        description: "High-level payment category (card, bank_transfer, voucher, other)"
      - name: payment_value
        description: "Payment amount"
        tests:
          - not_null
      - name: payment_installments
        description: "Number of payment installments"
      - name: installment_category
        description: "Categorized installment terms (single, short-term, medium-term, long-term)"

  - name: stg_order_items
    description: "Staging table for order items with product details, categories, and seller information"
    columns:
      - name: order_id
        description: "Foreign key to orders"
        tests:
          - not_null
      - name: product_id
        description: "Foreign key to products"
        tests:
          - not_null
      - name: seller_id
        description: "Foreign key to sellers"
      - name: item_price
        description: "Price of individual item"
      - name: freight_value
        description: "Shipping cost for item"
      - name: total_item_value
        description: "Total cost including item price and freight"
      - name: category_english
        description: "Product category in English"
      - name: category_portuguese
        description: "Original product category in Portuguese"